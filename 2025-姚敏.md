# 每周总结

## 2025.10

### 10.30

#### 学习进度
1.将patchmatchnet的主要代码看完
2.仔细研究了一下IMGTR这篇论文
#### 研究进度

#### 下周计划
1.跑通老师发的工具
2.研究如何进行一个改造

### 11.6

#### 学习进度
1.用三角剖分工具处理完DTU数据集
2.读取三角剖分的数据，读取的有些问题<img width="1311" height="525" alt="image" src="https://github.com/user-attachments/assets/076da5fb-aedc-4f8e-a8ba-d14419371d69" />
3.修改了patchmatchnet 的dataloader
#### 研究进度

#### 下周计划
1.解决三角剖分数据读取的问题
3.要进行两次班内汇报

### 11.13
#### 学习进度
1.解决了三角剖分读取数据的问题，更改了一下dataloader<img width="980" height="800" alt="image" src="https://github.com/user-attachments/assets/4fd48358-21b8-4019-844b-ed76bb5f5b1c" /> 

2.主要在弄最优化和新中特汇报

#### 下周计划
1.进行patchmatchnet改造

### 11.20
#### 研究进度
1. 这一周修改了dataloader的一个bug,将三角剖分数据添加到MVSdataset的时候，getitem时报错了因为一个批次里面数据的大小不一致，导致default_collate报错，然后通过跳过cdt-data，并在后面单独放入Gpu中
<img width="1510" height="228" alt="image" src="https://github.com/user-attachments/assets/d10f98c5-eb23-4224-935e-967b6fd174f7" />
<img width="855" height="415" alt="image" src="https://github.com/user-attachments/assets/b182517f-5e5f-420e-b319-6fe466157552" />

2.添加了边断裂预测头，生成每个三角掩码，将它们的特征聚合成一个特征向量，深度是求平均深度<img width="1175" height="339" alt="image" src="https://github.com/user-attachments/assets/7c548bb1-66e7-4177-8aed-15e544203316" />



3.有一个问题就是原来是多尺度提取,如果不下采样图片的话，显存过大会崩，采样过小会导致小三角形占不到一个像素，导致三角形掩码没有<img width="1304" height="508" alt="070d53cc242bf3cf6c1f8f354c6618c5" src="https://github.com/user-attachments/assets/b50a79a5-a8c2-44aa-9e39-7faf73eab120" />

### 11.27
#### 研究进度
1. 更改了边断裂预测头实现方式，从三角掩码生成特征向量，变为三个顶点加质点进行生成特征向量，深度采取四个点平均深度，因为现在是基于像素点，等之后得到平面方程的时候深度差变为共享边顶点深度差<img width="614" height="621" alt="image" src="https://github.com/user-attachments/assets/cdd76029-5b32-4aab-a396-6c5af6c668f3" />

2. 绘制了边断裂概率图，蓝(0.0) -> 青 -> 黄 -> 红(1.0)目前还没训练完<img width="924" height="468" alt="image" src="https://github.com/user-attachments/assets/8e7a7449-b33e-4881-a75a-9a0b182a2a7d" />
 

3. 修改完毕，但是训练的过程中突然出现深度图和特征图包含nan值，进行一个数据清洗保护操作之后，损失函数中，发现原本的depth-loss出现nan情况，而边断裂预测头loss正常，准备回滚一下版本看看是什么导致的

#### 下周计划
1. 训练出正常的变断裂概率图
2. 研究一下平面假设和传播
			
### 12.4
#### 研究进度
1. 更换了一个数据集blendedmvs，挑选了收集了城市，农村的俯视角数据集
2. 更改了一下dataloader
3. 正在训练，但是效果很差

### 12.10
#### 研究进度
1. 跑通了blendedmvs数据集，原先使用的dtu数据集对相机内外参专门进行了一个处理，投影矩阵的处理只适用于之前的dtu数据集，更改了一下投影矩阵处理方式以后数据集成功适配
2. 在城市还有农村数据集上patchmatchnet预测的深度图边界非常模糊
3. 对于平面假设,如果对于低分辨率图片进行三角剖分，会导致不是一个平面的物体变成一个平面，因为patchmatchnet是多尺度如果全分辨率三角剖分会导致后续的三角形太小，是不是还是得全局共享平面参数<img width="2222" height="1015" alt="image" src="https://github.com/user-attachments/assets/5d95b6f4-c88a-4e68-b7a7-639985b699c7" />
4. 我暂时思路是想在1/2分辨率进行三角剖分，将1/2的三角面作为全局平面，然后将三角剖分数据下采样进行patchmatch，然后得到1/2分辨率的三角平面方程，然后直接进行一个上采样得到全分辨率深度图，之后再想用什么办法将1/2三角平面投影到全分辨率的三角形上，使其全分辨率三角形能够继承1/2三角平面的数据

### 12.31
#### 研究进度
1.将武汉大学数据集适配到patchmatchnet，法向量对比<img width="2283" height="581" alt="image" src="https://github.com/user-attachments/assets/b660db2b-11cb-4ac9-8490-7186f27a5428" /> 
2.原分辨率<img width="1162" height="586" alt="image" src="https://github.com/user-attachments/assets/b8c45336-958c-4ea5-ae82-07d9479a36e5" />下采样分辨率<img width="1128" height="602" alt="image" src="https://github.com/user-attachments/assets/ff05d8e3-f4d7-4caf-aa9c-8b9367f58975" />
3.线段图<img width="1108" height="565" alt="image" src="https://github.com/user-attachments/assets/e2b2cc9f-7a3a-49e4-ad5b-c745318cc5c0" />
4.拟合平面<img width="866" height="650" alt="image" src="https://github.com/user-attachments/assets/945e8b67-d823-42da-9819-7bf97e62bab3" />
5.基于像素点和平面方程求深度值<img width="1181" height="897" alt="image" src="https://github.com/user-attachments/assets/4018d7fa-5f90-46cb-8dc3-aeaf6e35d72b" />
6.后续会设置一个0,0,1的保底平面，还有根据这个拟合好的平面，生成一些其他平面假设，合在一起计算匹配代价


#### 研究问题
0.数据集是五视角的，将图1作为固定的参考图，其他源图没有作为参考图进行训练是否要将其作为参考图进行训练<img width="808" height="526" alt="image" src="https://github.com/user-attachments/assets/297fd043-b352-4904-924a-3e9333ab13cc" />

1.只生成了参考图的深度图，没有加入源图的深度图，所以没有进行几何一致性过滤，只进行了一个光度置信度过滤，出来的效果并不好<img width="1763" height="950" alt="image" src="https://github.com/user-attachments/assets/9fed430c-97bc-4dcf-9d24-43830df9b1bb" />

2.后来用训练好的模型，将其他源图作为参考图进行生成深度图，然后将其深度图，只经过一个光度一致性过滤，然后直接转化为点云，<img width="2135" height="936" alt="image" src="https://github.com/user-attachments/assets/7dfba2ba-8000-4d33-a271-936d3008e229" />

3.

